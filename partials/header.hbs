<header class="mb-8 flex items-center px-3 py-3 dark:bg-gray-800 bg-gray-200 sticky top-0 z-10 shadow-card4">
    <div class="flex items-center gap-3 flex-grow">
        <button id="menu-toggle">
            <i class="bi bi-list text-2xl"></i>
        </button>
        <p class="m-0"><strong>Daniele Castiglia</strong></p>
    </div>
    {{> "color_mode_switch"}}
    <div id="navigation" class="flex flex-col items-start z-50 duration-500 dark:bg-gray-800 bg-gray-300 translate-x-backAll fixed left-0 top-0 h-screen w-sidebar p-5">
        <button id="close-sidebar">
            <i class="bi bi-x text-2xl opacity-60" style="margin-left: -6px;"></i>
        </button>
        <nav class="mt-4">
            {{navigation}}
        </nav>
        <div class="mt-auto opacity-60">
            {{> "partials/socials" mb="mb-3"}}
            <p class="text-center text-sm">Copyright&copy; Daniele Castiglia</p>
        </div>
    </div>
    <div class="z-20 hidden fixed top-0 left-0 duration-500 backdrop h-screen w-screen bg-gray-900 transition-opacity opacity-0"></div>
</header>
<script>
    let menuOpen = false;
    const menuToggle = document.getElementById("menu-toggle");
    const aside = document.querySelector("header #navigation");
    const closeSidebarBtn = document.getElementById("close-sidebar");
    const backdrop = document.querySelector("header .backdrop");

    aside.classList.remove("transition-transform");
    aside.classList.add("transition-transform");

    menuToggle.addEventListener("click", () => {
        aside.style.height = `${window.innerHeight}px`;
        (() => aside.scrollTop)();
        menuOpen = !menuOpen;
        aside.classList.add("translate-x-initial");
        aside.classList.remove("translate-x-backAll");
        document.body.classList.toggle("overflow-hidden");

        backdrop.classList.remove("hidden");
        (() => backdrop.scrollTop)(); // Force reflow
        backdrop.classList.remove("opacity-0");
        backdrop.classList.add("opacity-80");

        backdrop.addEventListener("click", closeSidebar);
        closeSidebarBtn.addEventListener("click", closeSidebar);
    });

    function closeSidebar() {
        menuOpen = false;
        aside.classList.remove("translate-x-initial");
        aside.classList.add("translate-x-backAll");
        document.body.classList.remove("overflow-hidden");

        backdrop.addEventListener("transitionend", () => {
            backdrop.classList.add("hidden");
            aside.style.height = null;
            (() => aside.scrollTop)();
        }, { once: true });

        backdrop.classList.remove("opacity-80");
        backdrop.classList.add("opacity-0");

        backdrop.removeEventListener("click", closeSidebar);
        closeSidebarBtn.removeEventListener("click", closeSidebar);
    }
</script>